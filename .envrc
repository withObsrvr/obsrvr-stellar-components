# .envrc for obsrvr-stellar-components
# This file is used by direnv to automatically set up the development environment

# Use Nix flake for development environment
use flake

# Set up project-specific environment variables
export PROJECT_ROOT="$(pwd)"
export DATA_DIR="$PROJECT_ROOT/data"
export LOG_DIR="$PROJECT_ROOT/logs"
export BUILD_DIR="$PROJECT_ROOT/build"
export DIST_DIR="$PROJECT_ROOT/dist"

# Stellar development configuration
export STELLAR_NETWORK="${STELLAR_NETWORK:-testnet}"
export STELLAR_RPC_URL="${STELLAR_RPC_URL:-https://soroban-testnet.stellar.org}"
export NETWORK_PASSPHRASE="${NETWORK_PASSPHRASE:-Test SDF Network ; September 2015}"

# Component configuration
export START_LEDGER="${START_LEDGER:-0}"
export BATCH_SIZE="${BATCH_SIZE:-1000}"
export PROCESSOR_THREADS="${PROCESSOR_THREADS:-4}"
export EVENT_TYPES="${EVENT_TYPES:-payment,path_payment_strict_receive,path_payment_strict_send}"

# Output configuration  
export OUTPUT_FORMATS="${OUTPUT_FORMATS:-parquet,json,websocket}"
export WEBSOCKET_PORT="${WEBSOCKET_PORT:-8080}"
export API_PORT="${API_PORT:-8081}"

# Performance configuration
export BUFFER_SIZE="${BUFFER_SIZE:-10000}"
export FLUSH_INTERVAL="${FLUSH_INTERVAL:-30s}"

# Monitoring configuration
export LOG_LEVEL="${LOG_LEVEL:-info}"
export METRICS_PORT="${METRICS_PORT:-9090}"
export ENABLE_METRICS="${ENABLE_METRICS:-true}"

# Docker configuration
export DOCKER_REGISTRY="${DOCKER_REGISTRY:-ghcr.io/withobsrvr}"
export DOCKER_TAG="${DOCKER_TAG:-latest}"

# Development utilities
export ENABLE_HOT_RELOAD="${ENABLE_HOT_RELOAD:-true}"
export ENABLE_DEBUG="${ENABLE_DEBUG:-false}"

# Create necessary directories
mkdir -p "$DATA_DIR" "$LOG_DIR" "$BUILD_DIR" "$DIST_DIR"

# Set up PATH for local binaries
PATH_add "$BUILD_DIR"

# Load additional environment files if they exist
dotenv_if_exists .env.local
dotenv_if_exists .env.development

# Print welcome message
echo "ðŸš€ obsrvr-stellar-components development environment loaded"
echo "   Project root: $PROJECT_ROOT"
echo "   Data dir:     $DATA_DIR"
echo "   Network:      $STELLAR_NETWORK"
echo "   RPC URL:      $STELLAR_RPC_URL"